generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int       @id @default(autoincrement())
  username  String    @unique @db.VarChar(50)
  email     String    @unique @db.VarChar(100)
  password  String    @db.VarChar(255)
  role      Role      @default(staff)
  isActive  Boolean   @default(true) @map("is_active")
  lastLogin DateTime? @map("last_login")
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")

  @@map("users")
}

model Category {
  id           Int       @id @default(autoincrement())
  name         String    @db.VarChar(100)
  slug         String    @unique @db.VarChar(100)
  description  String?   @db.Text
  imageUrl     String?   @map("image_url") @db.VarChar(255)
  displayOrder Int       @default(0) @map("display_order")
  isActive     Boolean   @default(true) @map("is_active")
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  products     Product[]

  @@map("categories")
}

model Product {
  id            Int            @id @default(autoincrement())
  name          String         @db.VarChar(200)
  slug          String         @unique @db.VarChar(200)
  description   String?        @db.Text
  categoryId    Int            @map("category_id")
  subcategory   String?        @db.VarChar(100)
  price         Decimal        @db.Decimal(10, 2)
  discountPrice Decimal?       @map("discount_price") @db.Decimal(10, 2)
  inStock       Boolean        @default(true) @map("in_stock")
  stockQuantity Int            @default(0) @map("stock_quantity")
  isFeatured    Boolean        @default(false) @map("is_featured")
  badge         String?        @db.VarChar(50)
  fabric        String?        @db.VarChar(100)
  workType      String?        @map("work_type") @db.VarChar(100)
  occasion      String?        @db.VarChar(100)
  sku           String?        @unique @db.VarChar(50)
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")
  category      Category       @relation(fields: [categoryId], references: [id])
  images        ProductImage[]
  sizes         ProductSize[]
  orderItems    OrderItem[]

  @@map("products")
  @@index([categoryId])
  @@index([isFeatured])
  @@index([inStock])
  @@index([slug])
}

model ProductImage {
  id           Int      @id @default(autoincrement())
  productId    Int      @map("product_id")
  imageUrl     String   @map("image_url") @db.VarChar(255)
  altText      String?  @map("alt_text") @db.VarChar(200)
  displayOrder Int      @default(0) @map("display_order")
  isPrimary    Boolean  @default(false) @map("is_primary")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  product      Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_images")
  @@index([productId])
  @@index([isPrimary])
}

model ProductSize {
  id            Int     @id @default(autoincrement())
  productId     Int     @map("product_id")
  size          String  @db.VarChar(20)
  stockQuantity Int     @default(0) @map("stock_quantity")
  isAvailable   Boolean @default(true) @map("is_available")
  product       Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, size])
  @@map("product_sizes")
}

model Customer {
  id        Int               @id @default(autoincrement())
  name      String            @db.VarChar(100)
  email     String?           @db.VarChar(100)
  phone     String            @unique @db.VarChar(15)
  createdAt DateTime          @default(now()) @map("created_at")
  updatedAt DateTime          @updatedAt @map("updated_at")
  addresses CustomerAddress[]
  orders    Order[]

  @@map("customers")
  @@index([phone])
  @@index([email])
}

model CustomerAddress {
  id          Int         @id @default(autoincrement())
  customerId  Int         @map("customer_id")
  addressType AddressType @default(home) @map("address_type")
  street      String      @db.VarChar(255)
  city        String      @db.VarChar(100)
  state       String      @db.VarChar(100)
  pincode     String      @db.VarChar(10)
  isDefault   Boolean     @default(false) @map("is_default")
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")
  customer    Customer    @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@map("customer_addresses")
  @@index([customerId])
  @@index([isDefault])
}

model Order {
  id             Int           @id @default(autoincrement())
  orderNumber    String        @unique @map("order_number") @db.VarChar(50)
  customerId     Int           @map("customer_id")
  customerName   String        @map("customer_name") @db.VarChar(100)
  customerEmail  String?       @map("customer_email") @db.VarChar(100)
  customerPhone  String        @map("customer_phone") @db.VarChar(15)
  shippingStreet String        @map("shipping_street") @db.VarChar(255)
  shippingCity   String        @map("shipping_city") @db.VarChar(100)
  shippingState  String        @map("shipping_state") @db.VarChar(100)
  shippingPincode String       @map("shipping_pincode") @db.VarChar(10)
  totalAmount    Decimal       @map("total_amount") @db.Decimal(10, 2)
  status         OrderStatus   @default(pending)
  paymentMethod  PaymentMethod @default(whatsapp) @map("payment_method")
  paymentStatus  PaymentStatus @default(pending) @map("payment_status")
  notes          String?       @db.Text
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @updatedAt @map("updated_at")
  customer       Customer      @relation(fields: [customerId], references: [id])
  items          OrderItem[]

  @@map("orders")
  @@index([customerId])
  @@index([orderNumber])
  @@index([status])
  @@index([createdAt])
}

model OrderItem {
  id           Int     @id @default(autoincrement())
  orderId      Int     @map("order_id")
  productId    Int     @map("product_id")
  productName  String  @map("product_name") @db.VarChar(200)
  productImage String? @map("product_image") @db.VarChar(255)
  size         String  @db.VarChar(20)
  quantity     Int     @default(1)
  price        Decimal @db.Decimal(10, 2)
  subtotal     Decimal @db.Decimal(10, 2)
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  order        Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product      Product  @relation(fields: [productId], references: [id])

  @@map("order_items")
  @@index([orderId])
  @@index([productId])
}

enum Role {
  admin
  staff
}

enum AddressType {
  home
  work
  other
}

enum OrderStatus {
  pending
  confirmed
  processing
  completed
  cancelled
}

enum PaymentMethod {
  whatsapp
  cod
  online
  upi
}

enum PaymentStatus {
  pending
  paid
  failed
}
